#!/usr/bin/env node

'use strict';

const program = require('commander');
const exists  = require('fs').existsSync;
const join    = require('path').join;
const spawn   = require('cross-spawn');
const chalk   = require('chalk');
const pk = require('../package.json');

program
    .usage('<command> [options]')
    .version(pk.version)
    .on('--help', echoHelp)
    .parse(process.argv);

const args = process.argv.slice(3);
let subCmd = program.args[0];

if (!subCmd) {
    program.help();
} else {
    const bin = executable(subCmd);
    !bin ? program.help() : wrap(spawn(bin, args, { stdio: 'inherit' }));
}

function wrap(sp) {
    sp.on('close', function(code) {
        process.exit(code);
    });
}

function executable(subCmd) {
    let file = join(__dirname, 'mri-' + subCmd);
    if (exists(file)) return file;
}

function echoHelp() {
    console.log('\n  Commands:');
    console.log();
    console.log(chalk.green('   mri pages   ') + '按路由文件生成pages文件夹');
    console.log(chalk.green('   mri dev     ') + '运行MRI开发环境');
    console.log(chalk.green('   mri build   ') + '编译MRI test测试环境项目');
    console.log(chalk.green('   mri prod    ') + '编译MRI prod生产环境项目');
}
